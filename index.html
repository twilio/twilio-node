<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="chrome=1"/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="canonical" href="http://twilio.com"/>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
    <title>twilio-node</title>
    <style>
        body {
            font-size: 14px;
            line-height: 22px;
            background: #f4f4f4;
            color: #000;
            font-family: Helvetica Neue, Helvetica, Arial;
        }

        .interface {
            font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, sans-serif !important;
        }

        div#sidebar {
            background: #fff;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 200px;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 15px 0 30px 30px;
            border-right: 1px solid #bbb;
            box-shadow: 0 0 20px #ccc;
            -webkit-box-shadow: 0 0 20px #ccc;
            -moz-box-shadow: 0 0 20px #ccc;
        }

        a.toc_title, a.toc_title:visited {
            display: block;
            color: black;
            font-weight: bold;
            margin-top: 15px;
        }

        a.toc_title:hover {
            text-decoration: underline;
        }

        #sidebar .version {
            font-size: 10px;
            font-weight: normal;
        }

        ul.toc_section {
            font-size: 11px;
            line-height: 14px;
            margin: 5px 0 0 0;
            padding-left: 0px;
            list-style-type: none;
            font-family: Lucida Grande;
        }

        .toc_section li {
            cursor: pointer;
            margin: 0 0 3px 0;
        }

        .toc_section li a {
            text-decoration: none;
            color: black;
        }

        .toc_section li a:hover {
            text-decoration: underline;
        }

        div.container {
            width: 550px;
            margin: 40px 0 50px 260px;
        }

        div.warning {
            margin-top: 15px;
            font: bold 11px Arial;
            color: #770000;
        }

        p {
            margin: 20px 0;
            width: 550px;
        }

        a, a:visited {
            color: #444;
        }

        a:active, a:hover {
            color: #000;
        }

        h1, h2, h3, h4, h5, h6 {
            padding-top: 20px;
        }

        h2 {
            font-size: 20px;
        }

        b.header {
            font-size: 16px;
            line-height: 30px;
        }

        span.alias {
            font-size: 14px;
            font-style: italic;
            margin-left: 20px;
        }

        table, tr, td {
            margin: 0;
            padding: 0;
        }

        td {
            padding: 2px 12px 2px 0;
        }

        table .rule {
            height: 1px;
            background: #ccc;
            margin: 5px 0;
        }

        ul {
            list-style-type: circle;
            padding: 0 0 0 20px;
        }

        li {
            width: 500px;
            margin-bottom: 10px;
        }

        code, pre, tt {
            font-family: Monaco, Consolas, "Lucida Console", monospace;
            font-size: 12px;
            line-height: 18px;
            font-style: normal;
        }

        tt {
            padding: 0px 3px;
            background: #fff;
            border: 1px solid #ddd;
            zoom: 1;
        }

        code {
            margin-left: 20px;
        }

        pre {
            font-size: 12px;
            padding: 2px 0 2px 15px;
            border-left: 5px solid #bbb;
            margin: 0px 0 30px;
        }

        @media only screen and (-webkit-min-device-pixel-ratio: 1.5) and (max-width: 640px), only screen and (-o-min-device-pixel-ratio: 3/2) and (max-width: 640px), only screen and (min-device-pixel-ratio: 1.5) and (max-width: 640px) {
            img {
                max-width: 100%;
            }

            div#sidebar {
                -webkit-overflow-scrolling: initial;
                position: relative;
                width: 90%;
                height: 120px;
                left: 0;
                top: -7px;
                padding: 10px 0 10px 30px;
                border: 0;
            }

            img#logo {
                width: auto;
                height: auto;
            }

            div.container {
                margin: 0;
                width: 100%;
            }

            p, div.container ul {
                max-width: 98%;
                overflow-x: scroll;
            }

            pre {
                overflow: scroll;
            }
        }

        td, th {
            text-align: left;
            padding:10px;
        }
    </style>
</head>
<body>

<a href="https://github.com/twilio/twilio-node"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

<div id="sidebar" class="interface">
    <span class="toc_title">
        twilio-node <span class="version">(2.1.0)</span>
    </span>

    <a class="toc_title" href="#">
        Introduction
    </a>
    <ul class="toc_section">
        <li>- <a href="#installation">Installation</a></li>
        <li>- <a href="#quickstart">Quick Start</a></li>
        <li>- <a href="#moreexamples">More Examples</a></li>
    </ul>

    <a class="toc_title" href="#restapi">
        Rest API Clients
    </a>
    <ul class="toc_section">
        <li>- <a href="#callbacks">Callbacks Versus Promises</a></li>
        <li>- <a href="#request">Raw Request</a></li>
    </ul>

    <a class="toc_title" href="#twimlResponse">
        TwimlResponse
    </a>
    <ul class="toc_section">
        <li>- <a href="#twimlResponse">Constructor</a></li>
        <li>- <a href="#twimlBasic">TwiML Basics</a></li>
        <li>- <a href="#twimlChained">Chaining Syntax</a></li>
        <li>- <a href="#twimlNesting">Nesting Syntax</a></li>
    </ul>

    <a class="toc_title" href="#capability">
        Capability
    </a>
    <ul class="toc_section">
        <li>- <a href="#capability">Constructor</a></li>
        <li>- <a href="#allowClientIncoming">allowClientIncoming</a></li>
        <li>- <a href="#allowClientOutgoing">allowClientOutgoing</a></li>
        <li>- <a href="#generate">generate</a></li>
    </ul>

    <a class="toc_title" href="#utilities">
        Utilities
    </a>
    <ul class="toc_section">
        <li>- <a href="#validateRequest">validateRequest</a></li>
        <li>- <a href="#validateExpressRequest">validateExpressRequest</a></li>
        <li>- <a href="#webhook">webhook (Express middleware)</a></li>
    </ul>

    <a class="toc_title" href="#links">
        Links
    </a>

</div>

<div class="container">

    <p id="introduction">
        <img id="logo" src="twilio.png" alt="Twilio: Cloud Communications"/>
    </p>

    <p>
        The Twilio platform makes adding voice, SMS, and VoIP capabilities to
        your applications ridiculously simple. This helper library for node
        aims to make it even easier. This documentation page code and format is
        adapted from the awesome/utilitary format used to document the popular
        <a href="http://backbonejs.org">Backbone</a> and
        <a href="http://underscorejs.org/">Underscore</a> JavaScript frameworks,
        created by <a href="https://twitter.com/jashkenas">Jeremy Ashkenas</a>
        and other open source contributors.
    </p>

    <p>
        The twilio-node project is
        <a href="http://github.com/twilio/twilio-node/">hosted on GitHub</a>.
        You can report bugs and discuss features on the
        <a href="http://github.com/twilio/twilio-node/issues">issues page</a>,
        on Freenode in the <tt>#twilio</tt> channel,
        or send tweets to <a href="http://twitter.com/kevinwhinnery">@kevinwhinnery</a>.
    </p>

    <h2 id="installation">Installation</h2>

    <p>twilio-node is available as an npm package. Install the latest version with:</p>
<pre>
npm install twilio
</pre>

    <h2 id="quickstart">Quick Start</h2>
    <p>
        To begin using Twilio to make voice calls, send SMS, and create VoIP clients, you first
        need to <a href="https://www.twilio.com/try-twilio">sign up for an account</a>.  After
        signing up, you will be able to access an account SID and auth token which will be used
        to authenticate requests to the Twilio back end.  This information can be found on
        <a href="https://www.twilio.com/user/account">your dashboard</a>:
    </p>
    <p>
        <img src="twilio-credentials.gif" alt="Click 'Show API Credentials' in your Twilio dashboard to reveal your Account SID and Auth Token"/>
    </p>
    <p>
        With these credentials, you can begin to use this node module, as in the following example:
    </p>
<pre>
//require the Twilio module and create a REST client
var client = require('twilio')('ACCOUNT_SID', 'AUTH_TOKEN');

//Send an SMS text message
client.sendMessage({

    to:'+16515556677', // Any number Twilio can deliver to
    from: '+14506667788', // A number you bought from Twilio and can use for outbound communication
    body: 'word to your mother.' // body of the SMS message

}, function(err, responseData) { //this function is executed when a response is received from Twilio

    if (!err) { // "err" is an error received during the request, if any

        // "responseData" is a JavaScript object containing data received from Twilio.
        // A sample response from sending an SMS message is here (click "JSON" to see how the data appears in JavaScript):
        // http://www.twilio.com/docs/api/rest/sending-sms#example-1

        console.log(responseData.from); // outputs "+14506667788"
        console.log(responseData.body); // outputs "word to your mother."

    }
});

//Place a phone call, and respond with TwiML instructions from the given URL
client.makeCall({

    to:'+16515556677', // Any number Twilio can call
    from: '+14506667788', // A number you bought from Twilio and can use for outbound communication
    url: 'http://www.example.com/twiml.php' // A URL that produces an XML document (TwiML) which contains instructions for the call

}, function(err, responseData) {

    //executed when the call has been initiated.
    console.log(responseData.from); // outputs "+14506667788"

});

</pre>

    <h2 id="moreexamples">More Examples</h2>
    <p>
        Example usage of the REST API can be found inline with our official
        <a href="https://www.twilio.com/docs/api/rest">REST API docs</a>.
    </p>

    <div id="documentation">

        <h2 id="restapi">REST API Clients</h2>

        <p>
            This module provides API clients for Twilio REST APIs. Please refer
            to the reference documentation linked below for API docs and
            specific examples. Clients are provided for:
        </p>

        <table>
            <tr>
                <th><a href="https://www.twilio.com/docs/api/rest">Core REST API</a></th>
                <td>Sending and receiving messages, making phone calls, accessing account data</td>
            </tr>
            <tr>
                <th><a href="https://www.twilio.com/docs/taskrouter">TaskRouter</a></th>
                <td>
                    Manage work distribution in a Twilio application, as in a
                    call center or lead distribution use case.
                </td>
            </tr>
            <tr>
                <th><a href="https://www.twilio.com/docs/api/rest/lookups">Phone Number Lookups</a></th>
                <td>
                    Get information about phone numbers and proper formatting.
                    Find out if it's a mobile number or a land line.
                </td>
            </tr>
        </table>

        <h3>REST API Examples:</h3>
<pre>
// Create a client:
var client = require('twilio')('ACCOUNT_SID', 'AUTH_TOKEN');

//Get a list of calls made by this account
// GET /2010-04-01/Accounts/ACCOUNT_SID/Calls
// alias for get is "list", if you prefer
client.calls.get(function(err, response) {
    response.calls.forEach(function(call) {
        console.log('Received call from: ' + call.from);
        console.log('Call duration (in seconds): ' + call.duration);
    });
});

//Get a list of calls made by this account, from this phone number
// GET /2010-04-01/Accounts/ACCOUNT_SID/Calls?From=+16513334455
client.calls.get({
    from:'+16513334455'
}, function(err, response) {
    response.calls.forEach(function(call) {
        console.log('Received call from: ' + call.from);
        console.log('This call\'s unique ID is: ' + call.sid);
    });
});

//Get data for a specific call
// GET /2010-04-01/Accounts/ACCOUNT_SID/Calls/abc123...
client.calls('abc123...').get(function(err, call) {
    console.log('This call\'s unique ID is: ' + call.sid);
    console.log('This call was created at: ' + call.dateCreated);
});

//Get data for a specific call, for a specific account
// GET /2010-04-01/Accounts/AC.../Calls/abc123...
client.accounts('AC...').calls('abc123...').get(function(err, response) {
    response.calls.forEach(function(call) {
        console.log('Received call from: ' + call.from);
        console.log('This call\'s unique ID is: ' + call.sid);
    });
});

// Create (send) an SMS message
// POST /2010-04-01/Accounts/ACCOUNT_SID/Messages
// "create" and "update" aliases are in place where appropriate on PUT and POST requests
client.messages.post({
    to:'+16515559999',
    from:'+14503334455',
    body:'word to your mother.'
}, function(err, text) {
    console.log('You sent: '+ text.body);
    console.log('Current status of this text message is: '+ text.status);
});

// Delete a TwiML application
// DELETE /2010-04-01/Accounts/ACCOUNT_SID/Applications/APP...
client.applications('APP...').delete(function(err, response, nodeResponse) {
    //DELETE requests do not return data - if there was no error, it worked.
    err ? console.log('There was an error') : console.log('it worked!');
});

</pre>

        <p>
            Any resource request you make can be done for a specific
            <a href="http://www.twilio.com/docs/api/rest/subaccounts">subaccount</a> as well.
            This lets you track usage of calls, text messages, etc. for different users of your
            application.  By default, all requests are made using the "master" account, but using
            the "accounts" resource allows you to make all the same requests, but for a specific account:
        </p>

<pre>
var client = require('twilio')('ACCOUNT_SID', 'AUTH_TOKEN'),
    SOME_SUBACCOUNT_SID = 'AC...';

//Send a text message, associated with the given subaccount
client.accounts(SOME_SUBACCOUNT_SID).sms.messages.create({
    to:'+16512223333',
    from:'+14505556677',
    body:'word to your subaccount mother.'
}, function(err, text) {
    console.log('You sent: '+ text.body);
    console.log('Current status of this text message is: '+ text.status);
});

//This REST call using the master/default account for the client...
client.makeCall({
    to:'+16512223333',
    from:'+14505556677',
    url:'http://example.com/someTwiml.php'
}, function(err, call) {
    console.log('This call\'s unique ID is: ' + call.sid);
    console.log('This call was created at: ' + call.dateCreated);
});

//...is the same as...
client.accounts(ACCOUNT_SID).calls.create({
    to:'+16512223333',
    from:'+14505556677',
    url:'http://example.com/someTwiml.php'
}, function(err, data) {
    console.log('This call\'s unique ID is: ' + call.sid);
    console.log('This call was created at: ' + call.dateCreated);
});
</pre>

        <h2 id="callbacks">Callbacks versus Promises</h2>
        <p>
            There are two ways to manage data that is returned from the REST API.
            Thus far, all of our examples have used callbacks to work with response
            data, using the node.js standard callback format of <tt>function(error, data) { ... }</tt>.
        </p>
        <p>
            However, it is common to need to make multiple sequential calls to the
            Twilio REST API, such as when searching for, then purchasing, new incoming
            phone numbers.  When you make multiple calls to Twilio using nested callbacks, your code
            can quickly start marching to the right, forming the dreaded
            "<a href="http://javascriptjabber.com/001-jsj-asynchronous-programming/">
            pyramid of doom</a>".
        </p>
        <p>
            One technique for unrolling nested callbacks is to use
            <a href="http://strongloop.com/strongblog/promises-in-node-js-with-q-an-alternative-to-callbacks/">promises</a>.  In node.js, the de facto standard library
            for providing promises is <a href="https://github.com/kriskowal/q">Q</a>.
            twilio-node uses Q to provide an alternative interface to callbacks
            where it makes sense.
        </p>
        <p>
            80% of the time, if you're just making a single request and you won't
            need the data again later, you should probably just use the callback interface.
            If you're making multiple calls in a row to Twilio, you might want to
            look at using promises instead.  Both work fine - it's up to you on
            what you'd prefer to use.
        </p>
        <p>
            For more information on how to work with the promise object,
            <a href="https://github.com/kriskowal/q">check out the reference docs
            for the Q library</a>.
        </p>
        <p>
            <b class="header">Promise Examples</b>
        </p>
<pre>
// Create an authenticated Twilio REST API client
var twilio = require('twilio');
var client = new twilio.RestClient('ACCOUNT_SID', 'AUTH_TOKEN');

// A simple example of making a phone call using promises
var promise = client.makeCall({
    to:'+16515556667777', // a number to call
    from:'+16518889999', // a Twilio number you own
    url:'https://demo.twilio.com/welcome/voice' // A URL containing TwiML instructions for the call
});

// You can assign functions to be called, at any time, after the request to
// Twilio has been completed.  The first function is called when the request
// succeeds, the second if there was an error.
promise.then(function(call) {
    console.log('Call success! Call SID: '+call.sid);
}, function(error) {
    console.error('Call failed!  Reason: '+error.message);
});

// Let's look at an example where we're making multiple requests to Twilio, like
// buying a new phone number.  This is where promises can become very useful:

// First, search for available phone numbers
client.availablePhoneNumbers('US').local.get({
    areaCode:'651'
}).then(function(searchResults) {

    // handle the case where there are no numbers found
    if (searchResults.availablePhoneNumbers.length < 1) {
        throw { message:'No numbers found with that area code' };
    }

    // Okay, so there are some available numbers.  Now, let's buy the first one
    // in the list.  Return the promise created by the next call to Twilio:
    return client.incomingPhoneNumbers.create({
        phoneNumber:searchResults.availablePhoneNumbers[0].phoneNumber,
        voiceUrl:'https://demo.twilio.com/welcome/voice',
        smsUrl:'https://demo.twilio.com/welcome/sms/reply'
    });

}).then(function(number) {

    // We bought the number!  Everything worked!
    console.log('Your new number: '+number.phoneNumber);

}).fail(function(error) {

    // This callback will be invoked on any error returned in the
    // process.
    console.log('Number purchase failed! Reason: '+error.message);

}).fin(function() {

    // You can use this optional callback like a "finally" block
    // It will always execute last.  Perform any cleanup necessary here.

});
</pre>

        <p id="request">
            <b class="header">request</b><code>client.request(requestOptions[, callback])</code>
            <br/>
            Makes an authenticated HTTP request against the Twilio back end. Typically, an end user
            <b>WILL NOT</b> use this function, but rather one of the resource-specific functions or
            shorthand functions.  <b>Returns</b> a <a href="#callbacks">promise</a> that can be
            used to work with data returned by the API.

            <ul>
                <li>
                    <b>requestOptions:</b> {object} HTTP request arguments,
                    same as <a href="https://github.com/mikeal/request">the request module</a>.
                </li>
                <li>
                    <b>[optional] callback:</b> {function} a callback function which receives the following
                    arguments, in order, after a request completes:
                    <ul>
                        <li><b>error:</b> An error object, if an error is received</li>
                        <li><b>responseData:</b>A JavaScript object, <tt>JSON.parse</tt>'d response from the Twilio HTTP response.</li>
                    </ul>
                </li>
            </ul>
        </p>
        <p>Example:</p>
<pre>
var twilio = require('twilio');
var client = new twilio.RestClient('ACCOUNT_SID', 'AUTH_TOKEN');

client.request({
    url:'/Accounts',
    method:'GET'
}, function (error, responseData) {
    //work with response data
});
</pre>


        <h2 id="twimlResponse">TwimlResponse</h2>

        <p>
            When your Twilio application needs to respond to an incoming SMS message or
            voice call input, the developer gives Twilio instructions on what to do using a
            special XML instruction set called "TwiML".  The <tt>TwimlResponse</tt> object
            makes creating a proper TwiML XML string very easy.  The resulting TwiML string
            can be rendered to the end user using the node.js HTTP server APIs directly, or
            using a higher level web framework like <a href="http://expressjs.com">express</a>.
        </p>

        <p >
            <b class="header">Constructor</b><code>new twilio.TwimlResponse()</code>
            <br/>

            Create a <a href="http://www.twilio.com/docs/api/twiml">TwiML</a>
            response, which can later be serialized to XML.
        <p>
        <p>Example:</p>
<pre>
var twilio = require('twilio');
var resp = new twilio.TwimlResponse();
</pre>

        <p id="twimlBasic">
            <b class="header">TwiML Basics</b>
            <br/>

            The <tt>TwimlResponse</tt> object provides JavaScript functions to construct the
            <a href="http://www.twilio.com/docs/api/twiml">TwiML verbs</a> that are appropriate
            for the given parent node.  Each JavaScript function takes the following arguments, in any order:
            <ul>
                <li>an <tt>Object</tt> hash containing the attributes for the parent XML node, if any</li>
                <li>a <tt>String</tt> containing the content of the XML node (as in a <tt>&lt;Say&gt;</tt> verb)</li>
                <li>if a string is not specified, a <tt>Function</tt> which will build child nodes of this node</li>
            </ul>
        </p>
<pre>
var twilio = require('twilio');
var resp = new twilio.TwimlResponse();

resp.say('Welcome to Twilio!');
resp.say('Please let us know if we can help during your development.', {
    voice:'woman',
    language:'en-gb'
});

console.log(resp.toString());
/**
Outputs the following:
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Response&gt;
    &lt;Say&gt;Welcome to Twilio!&lt;/Say&gt;
    &lt;Say voice="woman" language="en-gb"&gt;Please let us know if we can help during your development.&lt;/Say&gt;
&lt;/Response&gt;
*/
</pre>

        <p>
            Rendering the actual XML document is done with the <tt>toString</tt> function.  The following node
            program would render a TwiML document when a request was received to the HTTP server running on port
            1337:
        </p>

<pre>
var http = require('http'),
    twilio = require('twilio');

http.createServer(function (req, res) {
    //Create TwiML response
    var twiml = new twilio.TwimlResponse();
    twiml.say('Hello World!');

    res.writeHead(200, {'Content-Type': 'text/xml'});
    res.end(twiml.toString());

}).listen(1337, '127.0.0.1');

console.log('TwiML servin\' server running at http://127.0.0.1:1337/');
</pre>

        <p id="twimlChained">
            <b class="header">Chaining Syntax</b>
            <br/>
            You can add multiple nodes to a TwiML document in a single statement by chaining function calls:
        </p>

<pre>
var twilio = require('twilio');
var resp = new twilio.TwimlResponse();

resp.say('Welcome to Twilio!')
    .pause({ length:3 })
    .say('Please let us know if we can help during your development.', {
        voice:'woman',
        language:'en-gb'
    })
    .play('http://www.example.com/some_sound.mp3');

console.log(resp.toString());
/**
Outputs the following:
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Response&gt;
    &lt;Say&gt;Welcome to Twilio!&lt;/Say&gt;
    &lt;Pause length="3"&gt;&lt;/Pause&gt;
    &lt;Say voice="woman" language="en-gb"&gt;Please let us know if we can help during your development.&lt;/Say&gt;
    &lt;Play&gt;http://www.example.com/some_sound.mp3&lt;/Play&gt;
&lt;/Response&gt;
*/
</pre>

        <p id="twimlNesting">
            <b class="header">Nesting TwiML Nodes</b>
            <br/>
            Some TwiML verbs have other nouns or verbs nested within them.  You can create these nested structures
            by passing a function to a parent node, which will be executed in the context of the parent node.
            Within this callback function, <tt>this</tt> will refer to the parent node, which will have JavaScript
            functions that map to the allowed syntax for child nodes of the parent:
        </p>

<pre>
var twilio = require('twilio');
var resp = new twilio.TwimlResponse();

resp.say('Welcome to Acme Customer Service!')
    .gather({
        action:'http://www.example.com/callFinished.php',
        finishOnKey:'*'
    }, function() {
        this.say('Press 1 for customer service')
            .say('Press 2 for British customer service', { language:'en-gb' });
    });

console.log(resp.toString());
/**
Outputs the following:
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Response&gt;
    &lt;Say&gt;Welcome to Acme Customer Service!&lt;/Say&gt;
    &lt;Gather action="http://www.example.com/callFinished.php" finishOnKey="*"&gt;
        &lt;Say&gt;Press 1 for customer service.&lt;/Say&gt;
        &lt;Say language="en-gb"&gt;Press 2 for British customer service.&lt;/Say&gt;
    &lt;/Gather&gt;
&lt;/Response&gt;
*/
</pre>

        <p>
            Alternately, the first argument to the child node building function is also a reference to the parent
            node, so the following code is equivalent:
        </p>

<pre>
var twilio = require('twilio');
var resp = new twilio.TwimlResponse();

resp.say('Welcome to Acme Customer Service!')
    .gather({
        action:'http://www.example.com/callFinished.php',
        finishOnKey:'*'
    }, function(node) { //note the use of the "node" variable in the anonymous function

        //Now you can use this reference as well, if using "this" wrankles you
        node.say('Press 1 for customer service')
            .say('Press 2 for British customer service', { language:'en-gb' });

    });

console.log(resp.toString());
/**
Outputs the following:
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Response&gt;
    &lt;Say&gt;Welcome to Acme Customer Service!&lt;/Say&gt;
    &lt;Gather action="http://www.example.com/callFinished.php" finishOnKey="*"&gt;
        &lt;Say&gt;Press 1 for customer service.&lt;/Say&gt;
        &lt;Say language="en-gb"&gt;Press 2 for British customer service.&lt;/Say&gt;
    &lt;/Gather&gt;
&lt;/Response&gt;
*/
</pre>

        <p>
            Here is an example of how to generate a TwiML conference call:
        </p>

<pre>
var twilio = require('twilio');
var resp = new twilio.TwimlResponse();

resp.say('Your conference call is starting.',
    {
        voice:'woman',
        language:'en-gb'
    })
    .dial({
            action:'http://example.com/something.php'
        }, function(node) {
            node.conference('waitingRoom', {
            beep:'false'
        });
    });

console.log(resp.toString());
/**
Outputs the following:
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Response&gt;
    &lt;Say voice="woman" language="en-gb"&gt;Your conference call is starting.&lt;/Say&gt;
    &lt;Dial action="http://example.com/something.php"&gt;
        &lt;Conference beep="false"&gt;waitingRoom&lt;/Conference&gt;
    &lt;/Dial&gt;
&lt;/Response&gt;
*/
</pre>

        <h2 id="capability">Capability Token Generator</h2>

        <p>
            Using Twilio Client requires the use of a
            <a href="http://www.twilio.com/docs/client/capability-tokens">capability token</a>,
            which enables client access to Twilio's VoIP platform.  These capability tokens can
            be used either <a href="http://www.twilio.com/docs/client/twilio-js">in the browser</a>
            or in native apps for <a href="http://www.twilio.com/docs/client/ios">iOS</a> and
            <a href="http://www.twilio.com/docs/client/android">Android</a>.  This utility is intended
            to allow node.js applications the ability to generate these capability tokens on the
            server side.  For a complete node example using the express web framework, check out the
            <a href="https://github.com/twilio/twilio-node/tree/master/examples">examples</a> on
            GitHub.
        </p>

        <p>
            <b class="header">Constructor</b><code>new twilio.Capability(accountSid, authToken)</code>
            <br/>

            Create a capability token generator for use with Twilio Client.

            <ul>
                <li><b>accountSid:</b> {string} Twilio account SID</li>
                <li><b>authToken:</b> {string} Twilio auth token</li>
            </ul>
        <p>
        <p>Example:</p>
<pre>
var twilio = require('twilio');
var capability = new twilio.Capability(ACCOUNT_SID, AUTH_TOKEN);
</pre>

        <p id="allowClientIncoming">
            <b class="header">allowClientIncoming</b><code>capability.allowClientIncoming(clientName)</code>
            <br/>

            Add a capability to the token generator which will allow incoming calls to the given <tt>clientName</tt>.

            <ul>
                <li><b>clientName:</b> {string} the name of client which will accept incoming calls</li>
            </ul>
        <p>
        <p>Example:</p>
<pre>
var twilio = require('twilio');
var capability = new twilio.Capability(ACCOUNT_SID, AUTH_TOKEN);

//Create a capability token for a client named "jenny"
capability.allowClientIncoming('jenny');
var token = capability.generate();
</pre>

        <p id="allowClientOutgoing">
            <b class="header">allowClientOutgoing</b><code>capability.allowClientOutgoing(twimlAppSid)</code>
            <br/>

            Add a capability to the token generator which will allow the client to make outgoing calls,
            using the <a href="https://www.twilio.com/user/account/apps">TwiML app</a> with the given
            <tt>twimlAppSid</tt>

        <ul>
            <li><b>twimlAppSid:</b> {string} the SID of the TwiML app which will be used to make outgoing calls</li>
        </ul>
        <p>
        <p>Example:</p>
<pre>
var twilio = require('twilio');
var capability = new twilio.Capability(ACCOUNT_SID, AUTH_TOKEN);

//Create a capability token using the TwiML app with sid "AP123"
capability.allowClientOutgoing('AP123');
var token = capability.generate();
</pre>

        <p id="generate">
            <b class="header">generate</b><code>capability.generate([timeout])</code>
            <br/>

            Generate a capability token with the configured permissions, which by default will expire
            after one hour.

        <ul>
            <li><b>timeout (optional):</b> {number} time in seconds for the capability token to be valid</li>
        </ul>
        <p>
        <p>Example:</p>
<pre>
var twilio = require('twilio');
var capability = new twilio.Capability(ACCOUNT_SID, AUTH_TOKEN);

//Create a capability token using the TwiML app with sid "AP123", that expires in two minutes
capability.allowClientOutgoing('AP123');
var token = capability.generate(120);
</pre>

        <h2 id="utilities">Utilities</h2>

        <p id="validateRequest">
            <b class="header">validateRequest</b><code>twilio.validateRequest(authToken, header, url, params)</code>
            <br/>

            When Twilio sends a request to your web app, it sends a special header called <tt>X-Twilio-Signature</tt>.
            This header is a hashed value that we can use on the server side to confirm that a request has indeed
            originated from Twilio. More details on this security measure are located
            <a href="https://www.twilio.com/docs/security#validating-requests">here</a>.

            This function will return a boolean indicating whether or not, given the request URL, POST/GET parameters,
            and your auth token, a request was actually sent from Twilio.



            <ul>
                <li><b>authToken:</b> {string} your Twilio auth token</li>
                <li><b>header:</b> {string} the <tt>X-Twilio-Signature</tt> header sent by Twilio</li>
                <li><b>url:</b> {string} the URL requested by Twilio</li>
                <li><b>params:</b> {object} a JavaScript object containing key-value pairs of parameters sent by Twilio</li>
            </ul>
        <p>
        <p>Example:</p>
<pre>
var twilio = require('twilio'),
    http = require('http'),
    qs = require('querystring');

http.createServer(function (req, res) {

    if (req.method == 'POST') {
        var body = '';

        req.on('data', function (data) {
            body += data;
        });

        req.on('end', function () {

            var POST = qs.parse(body);

            //validate incoming request is from twilio using your auth token and the header from Twilio
            var token = 'YOUR_TWILIO_AUTH_TOKEN',
                header = req.headers['x-twilio-signature'];

            //validateRequest returns true if the request originated from Twilio
            if (twilio.validateRequest(token, header, 'http://twilio-raw.herokuapp.com', POST)) {
                //generate a TwiML response
                var resp = new twilio.TwimlResponse();
                resp.say('hello, twilio!');

                res.writeHead(200, { 'Content-Type':'text/xml' });
                res.end(resp.toString());
            }
            else {
                res.writeHead(403, { 'Content-Type':'text/plain' });
                res.end('you are not twilio - take a hike.');
            }
        });
    }
    else {
        res.writeHead(404, { 'Content-Type':'text/plain' });
        res.end('send a POST');
    }

}).listen(80);
</pre>

        <p id="validateExpressRequest">
            <b class="header">validateExpressRequest</b><code>twilio.validateExpressRequest(request, authToken)</code>
            <br/>

            This is a helper function which decomposes an <a href="http://expressjs.com/api.html#req.params">Express request object</a>
            and uses <a href="#validateRequest">validateRequest</a> to determine if the request was sent by Twilio.  Returns <tt>true</tt>
            if the request was sent by Twilio.  <b>NOTE:</b> This function requires the developer to use the <a href="https://www.npmjs.com/package/body-parser"><tt>bodyParser</tt></a> middleware to function. <a href="http://expressjs.com/api.html#req.body">Check out how to use this middleware in the express documentation</a>.

        <ul>
            <li><b>request:</b> {object} An Express Request object</li>
            <li><b>authToken:</b> {string} Your Twilio auth token</li>
            <li><b>options:</b> {object} Options for request validation:
                <ul>
                    <li><b>url</b>: The full Twilio webhook request URL you configured for your number, including any query parameters. Supercedes any configuration for <tt>host</tt> and <tt>protocol</tt> below. The default behavior of the request validator is to inspect the Express HTTP request object, and use information about the request to guess what the webhook URL is. You can use this property, or the below properties to override this behavior (useful if deployed to a PaaS like Heroku or ELB, or other infrastructure where Twilio's configured webhook URL might differ from the URL information on the HTTP request).</li>
                    <li><b>protocol</b>: Manually configure the protocol used in the Twilio webhook configuration. Defaults to the Express <tt>request.protocol</tt></li>
                    <li><b>host</b>: Manually configure the host name used in the Twilio webhook configuration. Defaults to the Express <tt>request.headers.host</tt></li>
                </ul>
            </li>
        </ul>
        <p>
        <p>Example:</p>
<pre>
var express = require('express'),
    bodyParser = require('body-parser'),
    http = require('http'),
    path = require('path'),
    twilio = require('twilio');

var app = express();

app.use(bodyParser.urlencoded({
    extended: true
}));

// Twilio request authentication
app.post('/twiml', function(req, res) {
    if (twilio.validateExpressRequest(req, 'YOUR_TWILIO_AUTH_TOKEN')) {
        var resp = new twilio.TwimlResponse();
        resp.say('express sez - hello twilio!');

        res.type('text/xml');
        res.send(resp.toString());
    }
    else {
        res.status(403).send('you are not twilio. Buzz off.');
    }
});

// Start an HTTP server with this Express app
app.listen(process.env.PORT || 3000);
</pre>

        <p>If you need to supply a custom URL you can do so like this:</p>

<pre>
var express = require('express'),
    bodyParser = require('body-parser'),
    http = require('http'),
    path = require('path'),
    twilio = require('twilio');

var app = express();

app.use(bodyParser.urlencoded({
    extended: true
}));

// Twilio request authentication with custom URL
app.post('/twiml', function(req, res) {
    var options = { url: 'https://subtle-gradient-188.herokuapp.com/twiml' };
    if (twilio.validateExpressRequest(req, 'YOUR_TWILIO_AUTH_TOKEN', options)) {
        var resp = new twilio.TwimlResponse();
        resp.say('express sez - hello twilio!');

        res.type('text/xml');
        res.send(resp.toString());
    }
    else {
        res.status(403).send('you are not twilio. Buzz off.');
    }
});

// Start an HTTP server with this Express app
app.listen(process.env.PORT || 3000);
</pre>

        <p id="webhook">
            <b class="header">webhook</b><code>twilio.webhook([authToken, options])</code>
            <br/>

            This function returns an <a href="http://expressjs.com/guide.html">Express middleware function</a> that uses <a href="#validateExpressRequest">validateExpressRequest</a> to determine if the request was sent by Twilio, and adds some API sugar to make the Express response object aware of <a href="#twimlResponse">TwimlResponse</a> objects and how to properly <tt>send()</tt> them.  Note that this middleware was built specifically for Express, and may or may not work with other Connect middleware-based frameworks.  Arguments can be passed in any order.  Request validation requires your Twilio auth token. <br/><br/>If validation is enabled (this is the default) and the request was sent by Twilio, the middleware calls <tt>next()</tt> and allows further processing.  If validation fails, it renders plain text and a 403 reponse. If no auth token is configured, it prints a message to console.error and returns a 500. <b>NOTE:</b> This function requires the developer to use the <a href="https://www.npmjs.com/package/body-parser"><tt>bodyParser</tt></a> middleware to function. <a href="http://expressjs.com/api.html#req.body">Check out how to use this middleware in the express documentation</a>.

        <ul>
            <li><b>authToken:</b> {string} Your Twilio auth token. If validation is enabled and none is provided, the module will look to <tt>process.env.TWILIO_AUTH_TOKEN</tt>. If that is also undefined, an error will be logged and your webhook URL will give a 500 error.</li>
            <li><b>options:</b> {object} Options for the middleware:
                <ul>
                    <li><b>validate:</b> {boolean} Whether or not the middleware should validate that the incoming request originated from Twilio.  Default: true.</li>
                    <li><b>includeHelpers:</b> {boolean} add helpers to the <a href="http://expressjs.com/api.html#res.status">Express response object</a> to improve support for <tt>TwimlResponse</tt> object rendering.  Default: true.</li>
                    <li><b>url:</b> See <a href="#validateExpressRequest">validateExpressRequest options above</a>.</li>
                    <li><b>host:</b> See <a href="#validateExpressRequest">validateExpressRequest options above</a>.</li>
                    <li><b>protocol:</b> See <a href="#validateExpressRequest">validateExpressRequest options above</a>.</li>
                </ul>
            </li>
        </ul>
        <p>
        <p>Example:</p>
<pre>
var express = require('express'),
    bodyParser = require('body-parser'),
    twilio = require('twilio');

// Create an express app which will parse form-encoded request bodies
var app = express();
app.use(bodyParser.urlencoded({
    extended: true
}));

// Create an SMS webhook that validates using your Twilio auth token, configured
// in "process.env.TWILIO_AUTH_TOKEN".  Also adds functionality to "response.send"
// to make it intelligently handle TwimlResponse objects.  If "response.send" is
// passed a TwimlResponse object, it will automatically set the proper
// Content-Type header and call "toString()" on the TwimlResponse object
app.post('/sms', twilio.webhook(), function(request, response) {
    var twiml = new twilio.TwimlResponse();
    twiml.message('This HTTP request came from Twilio!');
    response.send(twiml);
});

// Manually configure host and protocol info for the webhook you defined for your Twilio number
app.post('/foo/bar/sms', twilio.webhook({
    host:'gassy-ocelot-129.herokuapp.com',
    protocol:'https'
}), function(request, response) {
    var twiml = new twilio.TwimlResponse();
    twiml.message('This HTTP request came from Twilio!');
    response.send(twiml);
});

// Alternately, you could configure the whole URL...
app.post('/foo/bar/sms', twilio.webhook({
    url:'https://gassy-ocelot-129.herokuapp.com/foo/bar/sms',
}), function(request, response) {
    var twiml = new twilio.TwimlResponse();
    twiml.message('This HTTP request came from Twilio!');
    response.send(twiml);
});

// This webhook performs no validation - this might be used for a fallback URL
// for your Twilio number, to ensure a response is always sent back to the user.
app.post('/fallback', twilio.webhook({
    validate:false
}), function(request, response) {
    var twiml = new twilio.TwimlResponse();
    twiml.message('Sorry - there was an error processing your message.');
    response.send(twiml);
});

// Start an HTTP server with this Express app
app.listen(process.env.PORT || 3000);
</pre>


        <h2 id="links">Links &amp; Additional Resources</h2>
        <p>
            Usage of the Twilio platform requires a valid account SID and auth token.  You can sign up
            and receive those credentials <a href="https://www.twilio.com/try-twilio">here</a>.
        </p>

        <p>
            The official Twilio docs <a href="http://twilio.com/docs">are located here</a>.
        </p>

        <p>
            Helper libraries are available for a variety of environments and programming langauges -
            check out Twilio's <a href="http://github.com/twilio">GitHub repository here</a>.
        </p>

</div>

</body>
</html>
